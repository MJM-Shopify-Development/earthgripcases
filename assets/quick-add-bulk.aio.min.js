function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _callSuper(e,t,r){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}customElements.get("quick-add-bulk")||customElements.define("quick-add-bulk",(()=>{function r(){_classCallCheck(this,r),(t=_callSuper(this,r)).quantity=t.querySelector("quantity-input");var t,e=debounce(function(e){0===parseInt(e.target.value)?t.startQueue(e.target.dataset.index,parseInt(e.target.value)):t.validateQuantity(e)},ON_CHANGE_DEBOUNCE_TIMER),e=(t.addEventListener("change",e.bind(t)),t.listenForActiveInput(),t.listenForKeydown(),t.lastActiveInputId=null,new URLSearchParams(window.location.search));return window.pageNumber=decodeURIComponent(e.get("page")||""),t}return _inherits(r,BulkAdd),_createClass(r,[{key:"connectedCallback",value:function(){var t=this;this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,function(e){"quick-add"===e.source||e.cartData.items&&!e.cartData.items.some(function(e){return e.id===parseInt(t.dataset.index)})||e.cartData.variant_id&&e.cartData.variant_id!==parseInt(t.dataset.index)||t.onCartUpdate().then(function(){t.listenForActiveInput(),t.listenForKeydown()})})}},{key:"disconnectedCallback",value:function(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}},{key:"getInput",value:function(){return this.querySelector("quantity-input input")}},{key:"selectProgressBar",value:function(){return this.querySelector(".progress-bar-container")}},{key:"listenForActiveInput",value:function(){this.classList.contains("hidden")||this.getInput().addEventListener("focusin",function(e){return e.target.select()}),this.isEnterPressed=!1}},{key:"listenForKeydown",value:function(){var t=this;this.getInput().addEventListener("keydown",function(e){"Enter"===e.key&&(t.getInput().blur(),t.isEnterPressed=!0)})}},{key:"cleanErrorMessageOnType",value:function(e){e.target.addEventListener("keypress",function(){e.target.setCustomValidity("")},{once:!0})}},{key:"onCartUpdate",value:function(){var n=this;return new Promise(function(t,r){fetch(n.getSectionsUrl()+"?section_id="+n.closest(".collection").dataset.id).then(function(e){return e.text()}).then(function(e){(e=(new DOMParser).parseFromString(e,"text/html").querySelector("#quick-add-bulk-".concat(n.dataset.id,"-")+n.closest(".collection").dataset.id))&&(n.innerHTML=e.innerHTML),t()}).catch(function(e){console.error(e),r(e)})})}},{key:"updateMultipleQty",value:function(e){var t=this,r=(this.selectProgressBar().classList.remove("hidden"),Object.keys(e));e=JSON.stringify({updates:e,sections:this.getSectionsToRender().map(function(e){return e.section}),sections_url:this.getSectionsUrl()}),fetch(""+routes.cart_update_url,_objectSpread(_objectSpread({},fetchConfig()),{},{body:e})).then(function(e){return e.text()}).then(function(e){e=JSON.parse(e),t.renderSections(e,r),publish(PUB_SUB_EVENTS.cartUpdate,{source:"quick-add",cartData:e})}).catch(function(){}).finally(function(){t.selectProgressBar().classList.add("hidden"),t.requestStarted=!1})}},{key:"getSectionsToRender",value:function(){return[{id:"quick-add-bulk-".concat(this.dataset.id,"-")+this.closest(".collection-quick-add-bulk").dataset.id,section:this.closest(".collection-quick-add-bulk").dataset.id,selector:"#quick-add-bulk-".concat(this.dataset.id,"-")+this.closest(".collection-quick-add-bulk").dataset.id},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"CartDrawer",selector:"#CartDrawer",section:"cart-drawer"}]}},{key:"renderSections",value:function(r,t){var n=this;0===this.queue.filter(function(e){return t.includes(e.id)}).length&&(this.getSectionsToRender().forEach(function(e){var t=document.getElementById(e.id);t&&t.parentElement&&t.parentElement.classList.contains("drawer")&&(0<r.items.length?t.parentElement.classList.remove("is-empty"):t.parentElement.classList.add("is-empty"),setTimeout(function(){document.querySelector("#CartDrawer-Overlay").addEventListener("click",n.cart.close.bind(n.cart))})),(t=t&&t.querySelector(e.selector)?t.querySelector(e.selector):t)&&(t.innerHTML=n.getSectionInnerHTML(r.sections[e.section],e.selector))}),this.isEnterPressed&&this.querySelector("#Quantity-"+this.lastActiveInputId).select(),this.listenForActiveInput(),this.listenForKeydown())}}])})());